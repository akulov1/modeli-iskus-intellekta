<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Результат — рекомендации</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 24px; }
    .muted { color: #666; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body>
<div class="container">
  <a href="/" class="btn btn-outline-secondary mb-3">← Назад</a>

  <h1 class="mb-2">Рекомендации</h1>
  <p class="muted">
    Маршрут: <b>{{ origin.label if origin else "Краснодар" }}</b> → <b>{{ destination.label if destination else "—" }}</b>
    <span class="badge text-bg-info ms-2">{{ move_type_label }}</span>
  </p>

  <div class="row g-3 my-3">
    <div class="col-md-4">
      <div class="card h-100"><div class="card-body">
        <h5 class="card-title">Вещи</h5>
        <p class="mb-1">Кол-во предметов: <b>{{ n_items }}</b></p>
        <p class="mb-1">Хрупких: <b>{{ fragile_count }}</b></p>
      </div></div>
    </div>

    <div class="col-md-4">
      <div class="card h-100"><div class="card-body">
        <h5 class="card-title">Стоимость</h5>
        <p class="mb-1">Оценка: <b>{{ total_cost }}</b> ₽</p>
        <p class="mb-1">Из кармана: <b>{{ out_of_pocket }}</b> ₽</p>
        <p class="mb-1">Рекоменд. бюджет: <b>{{ recommended_budget }}</b> ₽</p>
        <p class="mb-0">Ваш бюджет: <b>{{ desired_budget }}</b> ₽
          {% if delta >= 0 %}
            <span class="badge text-bg-success ms-2">Хватает</span>
          {% else %}
            <span class="badge text-bg-danger ms-2">Не хватает</span>
          {% endif %}
        </p>
      </div></div>
    </div>

    <div class="col-md-4">
      <div class="card h-100"><div class="card-body">
        <h5 class="card-title">Даты</h5>
        <p class="mb-1">Критический путь: <b>{{ project_days }}</b> дн.</p>
        <p class="mb-1">Буфер: <b>{{ buffer_days }}</b> дн.</p>
        <p class="mb-1">Рекомендуемая дата переезда: <b class="mono">{{ recommended_move_date }}</b></p>
        {% if desired_move_date %}
          <p class="mb-0">Ваша дата: <b class="mono">{{ desired_move_date }}</b>
            {% if feasible %}
              <span class="badge text-bg-success ms-2">Реалистично</span>
            {% else %}
              <span class="badge text-bg-danger ms-2">Рано</span>
            {% endif %}
          </p>
        {% endif %}
      </div></div>
    </div>
  </div>

  <h4 class="mt-4">Разбивка услуг</h4>
  <table class="table table-sm">
    <thead><tr><th>Услуга</th><th class="text-end">Стоимость</th></tr></thead>
    <tbody>
      {% for name, cost in breakdown.items() %}
        <tr><td>{{ name }}</td><td class="text-end">{{ cost }} ₽</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <h4 class="mt-4">План задач (по зависимостям)</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Задача</th>
        <th>Зависит от</th>
        <th class="text-end">Длительность</th>
        <th class="mono">Старт</th>
        <th class="mono">Финиш</th>
      </tr>
    </thead>
    <tbody>
      {% for row in schedule %}
        <tr>
          <td><b>{{ row.task.label }}</b><div class="muted">{{ row.task.description }}</div></td>
          <td class="muted">{% if row.deps %}{{ ", ".join(row.deps) }}{% else %}—{% endif %}</td>
          <td class="text-end">{{ row.days }} дн.</td>
          <td class="mono">{{ row.start }}</td>
          <td class="mono">{{ row.end }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
</body>
</html>
